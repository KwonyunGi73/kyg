# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: AI-Powered README Update with Gemini

# ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë  ì¡°ê±´ (main ë¸Œëœì¹˜ë¡œ Pull Requestê°€ ë‹«íˆê³ , Merged ë˜ì—ˆì„ ë•Œ)
on:
  pull_request:
    types: [closed]

jobs:
  update-readme:
    # PRì´ ë³‘í•©(merged)ë˜ì—ˆì„ ë•Œë§Œ ì‹¤í–‰
    if: github.event.pull_request.merged == true
    
    # ìš°ë¶„íˆ¬ ìµœì‹  ê°€ìƒ í™˜ê²½ì—ì„œ ì‹¤í–‰
    runs-on: ubuntu-latest
    
    # ì›Œí¬í”Œë¡œìš°ê°€ ë¦¬í¬ì§€í† ë¦¬ ë‚´ìš©ì„ ìˆ˜ì •í•˜ê³  ì»¤ë°‹í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œ ë¶€ì—¬
    permissions:
      contents: write

    steps:
      # 1. í˜„ì¬ ë¦¬í¬ì§€í† ë¦¬ì˜ ì½”ë“œë¥¼ ê°€ìƒ í™˜ê²½ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤ (í•„ìˆ˜ ë‹¨ê³„)
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # READMEë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  í‘¸ì‹œí•˜ë ¤ë©´ ì „ì²´ git íˆìŠ¤í† ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          fetch-depth: 0

      # 2. Gemini AIë¥¼ ì´ìš©í•´ PR ë³€ê²½ ì‚¬í•­ì„ ìš”ì•½í•˜ëŠ” ì•¡ì…˜
      #    ì´ ì•¡ì…˜ì€ Gemini APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œ ë³€ê²½ ë‚´ìš©ì„ ë¶„ì„í•©ë‹ˆë‹¤.
      - name: Generate PR summary with Gemini
        id: pr_summary
        uses: SubstraFoundation/pr-summary-with-gemini-action@v1
        with:
          # ê¹ƒí—ˆë¸Œ í† í°ì€ ê¸°ë³¸ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # 3ë‹¨ê³„ì—ì„œ ì €ì¥í–ˆë˜ Gemini API í‚¤ë¥¼ ì—¬ê¸°ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          # AIì—ê²Œ ë‚´ë¦¬ëŠ” ëª…ë ¹ (í”„ë¡¬í”„íŠ¸). ì´ ë¶€ë¶„ì„ ìˆ˜ì •í•´ì„œ ìš”ì•½ ìŠ¤íƒ€ì¼ì„ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          prompt: |
            ì´ Pull Requestì˜ ì½”ë“œ ë³€ê²½ ì‚¬í•­ì„ ë¶„ì„í•´ì„œ, README íŒŒì¼ì— ì¶”ê°€í•  "## ğŸš€ ìµœê·¼ ë³€ê²½ ì‚¬í•­" ì„¹ì…˜ì„ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì¤˜.
            ì£¼ìš” ë³€ê²½ì  1~3ê°€ì§€ë¥¼ ê¸€ë¨¸ë¦¬ ê¸°í˜¸(-)ë¡œ ìš”ì•½í•˜ê³ , ê° í•­ëª©ì€ ë¹„ê°œë°œìë„ ì´í•´í•˜ê¸° ì‰½ê²Œ í•œ ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ì„¤ëª…í•´ì¤˜.

      # 3. AIê°€ ìƒì„±í•œ ìš”ì•½ ë‚´ìš©ì„ README íŒŒì¼ì˜ ë§¨ ìœ„ì— ì¶”ê°€
      - name: Update README.md
        run: |
          # AIê°€ ìƒì„±í•œ ìš”ì•½ ë‚´ìš©ì„ ë³€ìˆ˜ì— ì €ì¥
          SUMMARY="${{ steps.pr_summary.outputs.summary }}"
          
          # ê¸°ì¡´ README íŒŒì¼ì´ ìˆë‹¤ë©´ ë°±ì—…í•˜ê³ , ì—†ë‹¤ë©´ ë¹ˆ ë°±ì—… íŒŒì¼ ìƒì„±
          if [ -f README.md ]; then
            mv README.md README.md.bak
          else
            touch README.md.bak
          fi
          
          # ìƒˆë¡œìš´ ë‚´ìš©ì„ ë‹´ì€ README.md íŒŒì¼ ìƒì„±
          echo "## ğŸš€ AIê°€ ìš”ì•½í•œ ìµœê·¼ ë³€ê²½ ì‚¬í•­" > README.md
          echo "" >> README.md
          echo "$SUMMARY" >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "" >> README.md
          # ë°±ì—…í•´ë‘” ê¸°ì¡´ README ë‚´ìš©ê³¼ í•©ì¹˜ê¸°
          cat README.md.bak >> README.md
          # ì„ì‹œ ë°±ì—… íŒŒì¼ ì‚­ì œ
          rm README.md.bak

      # 4. ë³€ê²½ëœ README.md íŒŒì¼ì„ ìë™ìœ¼ë¡œ ì»¤ë°‹í•˜ê³  í‘¸ì‹œ
      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: AIê°€ README ìë™ ì—…ë°ì´íŠ¸"
          file_pattern: README.md